2023-08-09 16:37:38,495 - allrank.utils.ltr_logging - INFO - created paths container PathsContainer(local_base_output_path='results-new/', base_output_path='results-new/', output_dir='results-new/results\\novo-testemq2007', tensorboard_output_path='results-new/tb_evals\\single\\novo-testemq2007', config_path='localtemp_config.json')
2023-08-09 16:37:38,495 - allrank.utils.ltr_logging - INFO - Config:
 {'click_model': None,
 'data': DataConfig(path='D:\\Colecoes\\BD\\MQ2007\\MQ2007\\Fold1', num_workers=0, batch_size=20, slate_length=100, validation_ds_role='vali'),
 'detect_anomaly': True,
 'expected_metrics': {'val': {'georisk_10': 0.0,
                              'lndcg_10': 0.0,
                              'lndcg_5': 0.0,
                              'ndcg_10': 0.0,
                              'ndcg_5': 0.0}},
 'loss': NameArgsConfig(name='geoRiskSpearmanLoss', args={}),
 'lr_scheduler': NameArgsConfig(name=None, args={'step_size': 800, 'gamma': 0.5}),
 'metrics': defaultdict(<class 'list'>,
                        {'georisk': [10],
                         'lndcg': [5,
                                   10],
                         'lndcg1': [5,
                                    10],
                         'ndcg': [5,
                                  10],
                         'ndcg1': [5,
                                   10]}),
 'model': ModelConfig(fc_model={}, transformer=TransformerConfig(N=2, d_ff=32, h=2, positional_encoding=None, dropout=0.3), post_model={'output_activation': 'Sigmoid', 'd_output': 1}),
 'optimizer': NameArgsConfig(name='Adam', args={'lr': 0.0001}),
 'training': TrainingConfig(epochs=1, gradient_clipping_norm=None, early_stopping_patience=100),
 'val_metric': 'ndcg_10'}
2023-08-09 16:37:38,496 - allrank.utils.ltr_logging - INFO - will execute copy "localtemp_config.json" "results-new/results\novo-testemq2007\used_config.json"
2023-08-09 16:37:38,507 - allrank.utils.ltr_logging - INFO - exit_code = 0
2023-08-09 16:37:38,507 - allrank.utils.ltr_logging - INFO - will load train data from D:\Colecoes\BD\MQ2007\MQ2007\Fold1\Norm.train.txt
2023-08-09 16:37:39,745 - allrank.utils.ltr_logging - INFO - loaded dataset from <_io.BufferedReader name='D:\\Colecoes\\BD\\MQ2007\\MQ2007\\Fold1\\Norm.train.txt'> and got x shape (42158, 46), y shape (42158,) and query_ids shape (42158,)
2023-08-09 16:37:39,754 - allrank.utils.ltr_logging - INFO - loaded dataset with 1017 queries
2023-08-09 16:37:39,754 - allrank.utils.ltr_logging - INFO - longest query had 147 documents
2023-08-09 16:37:39,756 - allrank.utils.ltr_logging - INFO - train DS shape: [1017, 147, 46]
2023-08-09 16:37:39,756 - allrank.utils.ltr_logging - INFO - will load vali data from D:\Colecoes\BD\MQ2007\MQ2007\Fold1\Norm.vali.txt
2023-08-09 16:37:40,163 - allrank.utils.ltr_logging - INFO - loaded dataset from <_io.BufferedReader name='D:\\Colecoes\\BD\\MQ2007\\MQ2007\\Fold1\\Norm.vali.txt'> and got x shape (13813, 46), y shape (13813,) and query_ids shape (13813,)
2023-08-09 16:37:40,166 - allrank.utils.ltr_logging - INFO - loaded dataset with 339 queries
2023-08-09 16:37:40,167 - allrank.utils.ltr_logging - INFO - longest query had 88 documents
2023-08-09 16:37:40,167 - allrank.utils.ltr_logging - INFO - vali DS shape: [339, 88, 46]
2023-08-09 16:37:40,167 - allrank.utils.ltr_logging - INFO - Will pad to the longest slate: 88
2023-08-09 16:37:40,167 - allrank.utils.ltr_logging - INFO - will load test data from D:\Colecoes\BD\MQ2007\MQ2007\Fold1\Norm.test.txt
2023-08-09 16:37:40,556 - allrank.utils.ltr_logging - INFO - loaded dataset from <_io.BufferedReader name='D:\\Colecoes\\BD\\MQ2007\\MQ2007\\Fold1\\Norm.test.txt'> and got x shape (13652, 46), y shape (13652,) and query_ids shape (13652,)
2023-08-09 16:37:40,560 - allrank.utils.ltr_logging - INFO - loaded dataset with 336 queries
2023-08-09 16:37:40,560 - allrank.utils.ltr_logging - INFO - longest query had 80 documents
2023-08-09 16:37:40,561 - allrank.utils.ltr_logging - INFO - test DS shape: [336, 80, 46]
2023-08-09 16:37:40,561 - allrank.utils.ltr_logging - INFO - Will pad to the longest slate: 80
2023-08-09 16:37:40,562 - allrank.utils.ltr_logging - INFO - total batch size is 20
2023-08-09 16:37:40,562 - allrank.utils.ltr_logging - INFO - Model training will execute on cpu
2023-08-09 16:37:40,568 - allrank.utils.ltr_logging - INFO - Model has 23847 trainable parameters
2023-08-09 16:37:40,569 - allrank.utils.ltr_logging - INFO - Current learning rate: 0.0001
2023-08-09 16:39:28,706 - allrank.utils.ltr_logging - INFO - Epoch : 0 Train loss: 0.4946402260921932 Val loss: 0.49349007212658547 Train ndcg_5 0.20949460566043854 Train ndcg_10 0.24071229994297028 Train lndcg_5 0.22683368623256683 Train lndcg_10 0.2567291855812073 Train lndcg1_5 0.3641287684440613 Train lndcg1_10 0.39572373032569885 Train ndcg1_5 0.3649878203868866 Train ndcg1_10 0.3944714367389679 Train georisk_10 0.33349522948265076 Val ndcg_5 0.23084378242492676 Val ndcg_10 0.2719804346561432 Val lndcg_5 0.24173031747341156 Val lndcg_10 0.28133106231689453 Val lndcg1_5 0.37152379751205444 Val lndcg1_10 0.4111245274543762 Val ndcg1_5 0.36063721776008606 Val ndcg1_10 0.40177398920059204 Val georisk_10 0.3383088707923889
2023-08-09 16:39:28,707 - allrank.utils.ltr_logging - INFO - Current:0.2719804346561432 Best:0.0
2023-08-09 16:39:31,348 - allrank.utils.ltr_logging - INFO - MY-flag writted predictions - because model is best on validation. Test metrics: {'ndcg_5': 0.25423592398197187, 'ndcg_10': 0.28529777583825816, 'lndcg_5': 0.2646799852772227, 'lndcg_10': 0.29399472023500667, 'lndcg1_5': 0.40158474718198456, 'lndcg1_10': 0.43089948213976853, 'ndcg1_5': 0.3911406858867338, 'ndcg1_10': 0.42220253774302} 
2023-08-09 16:39:31,349 - allrank.utils.ltr_logging - INFO - Ending execution. Train Losses:
[0.4946402260921932]
2023-08-09 16:39:31,349 - allrank.utils.ltr_logging - INFO - Ending execution. Validation Losses (not used to train):
[0.49349007212658547]
2023-08-09 16:39:31,349 - allrank.utils.ltr_logging - INFO - Ending execution. Train Metrics Evolution:
[{'ndcg_5': 0.2094946, 'ndcg_10': 0.2407123, 'lndcg_5': 0.22683369, 'lndcg_10': 0.2567292, 'lndcg1_5': 0.36412877, 'lndcg1_10': 0.39572373, 'ndcg1_5': 0.36498782, 'ndcg1_10': 0.39447144, 'georisk_10': 0.33349523}]
2023-08-09 16:39:31,349 - allrank.utils.ltr_logging - INFO - Ending execution. Validation Metrics Evolution:
[{'ndcg_5': 0.23084378, 'ndcg_10': 0.27198043, 'lndcg_5': 0.24173032, 'lndcg_10': 0.28133106, 'lndcg1_5': 0.3715238, 'lndcg1_10': 0.41112453, 'ndcg1_5': 0.36063722, 'ndcg1_10': 0.401774, 'georisk_10': 0.33830887}]
2023-08-09 16:39:31,349 - allrank.utils.ltr_logging - INFO - Ending execution. Test Metrics Evolution:
[{'ndcg_5': 0.25423592398197187, 'ndcg_10': 0.28529777583825816, 'lndcg_5': 0.2646799852772227, 'lndcg_10': 0.29399472023500667, 'lndcg1_5': 0.40158474718198456, 'lndcg1_10': 0.43089948213976853, 'ndcg1_5': 0.3911406858867338, 'ndcg1_10': 0.42220253774302}]
2023-08-09 16:39:31,411 - allrank.utils.ltr_logging - INFO - created paths container PathsContainer(local_base_output_path='results-new/', base_output_path='results-new/', output_dir='results-new/results\\novo-testeweb10k', tensorboard_output_path='results-new/tb_evals\\single\\novo-testeweb10k', config_path='localtemp_config.json')
2023-08-09 16:39:31,412 - allrank.utils.ltr_logging - INFO - Config:
 {'click_model': None,
 'data': DataConfig(path='D:\\Colecoes\\BD\\web10k-norm\\Fold1', num_workers=0, batch_size=20, slate_length=100, validation_ds_role='vali'),
 'detect_anomaly': True,
 'expected_metrics': {'val': {'georisk_10': 0.0,
                              'lndcg_10': 0.0,
                              'lndcg_5': 0.0,
                              'ndcg_10': 0.0,
                              'ndcg_5': 0.0}},
 'loss': NameArgsConfig(name='geoRiskSpearmanLoss', args={}),
 'lr_scheduler': NameArgsConfig(name=None, args={'step_size': 800, 'gamma': 0.5}),
 'metrics': defaultdict(<class 'list'>,
                        {'georisk': [10],
                         'lndcg': [5,
                                   10],
                         'lndcg1': [5,
                                    10],
                         'ndcg': [5,
                                  10],
                         'ndcg1': [5,
                                   10]}),
 'model': ModelConfig(fc_model={}, transformer=TransformerConfig(N=2, d_ff=32, h=2, positional_encoding=None, dropout=0.3), post_model={'output_activation': 'Sigmoid', 'd_output': 1}),
 'optimizer': NameArgsConfig(name='Adam', args={'lr': 0.0001}),
 'training': TrainingConfig(epochs=1, gradient_clipping_norm=None, early_stopping_patience=100),
 'val_metric': 'ndcg_10'}
2023-08-09 16:39:31,413 - allrank.utils.ltr_logging - INFO - will execute copy "localtemp_config.json" "results-new/results\novo-testeweb10k\used_config.json"
2023-08-09 16:39:31,424 - allrank.utils.ltr_logging - INFO - exit_code = 0
2023-08-09 16:39:31,424 - allrank.utils.ltr_logging - INFO - will load train data from D:\Colecoes\BD\web10k-norm\Fold1\Norm.train.txt
2023-08-09 16:39:59,117 - allrank.utils.ltr_logging - INFO - loaded dataset from <_io.BufferedReader name='D:\\Colecoes\\BD\\web10k-norm\\Fold1\\Norm.train.txt'> and got x shape (351100, 136), y shape (351100,) and query_ids shape (351100,)
2023-08-09 16:39:59,418 - allrank.utils.ltr_logging - INFO - loaded dataset with 3511 queries
2023-08-09 16:39:59,419 - allrank.utils.ltr_logging - INFO - longest query had 100 documents
2023-08-09 16:39:59,511 - allrank.utils.ltr_logging - INFO - train DS shape: [3511, 100, 136]
2023-08-09 16:39:59,511 - allrank.utils.ltr_logging - INFO - will load vali data from D:\Colecoes\BD\web10k-norm\Fold1\Norm.vali.txt
2023-08-09 16:40:08,124 - allrank.utils.ltr_logging - INFO - loaded dataset from <_io.BufferedReader name='D:\\Colecoes\\BD\\web10k-norm\\Fold1\\Norm.vali.txt'> and got x shape (112000, 136), y shape (112000,) and query_ids shape (112000,)
2023-08-09 16:40:08,218 - allrank.utils.ltr_logging - INFO - loaded dataset with 1120 queries
2023-08-09 16:40:08,218 - allrank.utils.ltr_logging - INFO - longest query had 100 documents
2023-08-09 16:40:08,245 - allrank.utils.ltr_logging - INFO - vali DS shape: [1120, 100, 136]
2023-08-09 16:40:08,245 - allrank.utils.ltr_logging - INFO - Will pad to the longest slate: 100
2023-08-09 16:40:08,245 - allrank.utils.ltr_logging - INFO - will load test data from D:\Colecoes\BD\web10k-norm\Fold1\Norm.test.txt
2023-08-09 16:40:16,996 - allrank.utils.ltr_logging - INFO - loaded dataset from <_io.BufferedReader name='D:\\Colecoes\\BD\\web10k-norm\\Fold1\\Norm.test.txt'> and got x shape (113300, 136), y shape (113300,) and query_ids shape (113300,)
2023-08-09 16:40:17,091 - allrank.utils.ltr_logging - INFO - loaded dataset with 1133 queries
2023-08-09 16:40:17,091 - allrank.utils.ltr_logging - INFO - longest query had 100 documents
2023-08-09 16:40:17,118 - allrank.utils.ltr_logging - INFO - test DS shape: [1133, 100, 136]
2023-08-09 16:40:17,119 - allrank.utils.ltr_logging - INFO - Will pad to the longest slate: 100
2023-08-09 16:40:17,119 - allrank.utils.ltr_logging - INFO - total batch size is 20
2023-08-09 16:40:17,119 - allrank.utils.ltr_logging - INFO - Model training will execute on cpu
2023-08-09 16:40:17,126 - allrank.utils.ltr_logging - INFO - Model has 168297 trainable parameters
2023-08-09 16:40:17,127 - allrank.utils.ltr_logging - INFO - Current learning rate: 0.0001
2023-08-09 16:49:13,094 - allrank.utils.ltr_logging - INFO - Epoch : 0 Train loss: 0.15741324206595067 Val loss: 0.151577390730381 Train ndcg_5 0.1803773194551468 Train ndcg_10 0.2098483294248581 Train lndcg_5 0.25763052701950073 Train lndcg_10 0.28220081329345703 Train lndcg1_5 0.25812557339668274 Train lndcg1_10 0.2824411392211914 Train ndcg1_5 0.1808759868144989 Train ndcg1_10 0.21057821810245514 Train georisk_10 0.2757259011268616 Val ndcg_5 0.18065990507602692 Val ndcg_10 0.20824846625328064 Val lndcg_5 0.2601303458213806 Val lndcg_10 0.28250616788864136 Val lndcg1_5 0.2619631588459015 Val lndcg1_10 0.2843247056007385 Val ndcg1_5 0.18248283863067627 Val ndcg1_10 0.21006157994270325 Val georisk_10 0.27610570192337036
2023-08-09 16:49:13,095 - allrank.utils.ltr_logging - INFO - Current:0.20824846625328064 Best:0.0
2023-08-09 16:49:26,927 - allrank.utils.ltr_logging - INFO - MY-flag writted predictions - because model is best on validation. Test metrics: {'ndcg_5': 0.17714049886199634, 'ndcg_10': 0.20812090145245263, 'lndcg_5': 0.25620555306521425, 'lndcg_10': 0.2825790913928214, 'lndcg1_5': 0.2570881655983122, 'lndcg1_10': 0.2834617039259194, 'ndcg1_5': 0.1780231113950943, 'ndcg1_10': 0.2090035139855506} 
2023-08-09 16:49:26,928 - allrank.utils.ltr_logging - INFO - Ending execution. Train Losses:
[0.15741324206595067]
2023-08-09 16:49:26,928 - allrank.utils.ltr_logging - INFO - Ending execution. Validation Losses (not used to train):
[0.151577390730381]
2023-08-09 16:49:26,928 - allrank.utils.ltr_logging - INFO - Ending execution. Train Metrics Evolution:
[{'ndcg_5': 0.18037732, 'ndcg_10': 0.20984833, 'lndcg_5': 0.25763053, 'lndcg_10': 0.2822008, 'lndcg1_5': 0.25812557, 'lndcg1_10': 0.28244114, 'ndcg1_5': 0.18087599, 'ndcg1_10': 0.21057822, 'georisk_10': 0.2757259}]
2023-08-09 16:49:26,928 - allrank.utils.ltr_logging - INFO - Ending execution. Validation Metrics Evolution:
[{'ndcg_5': 0.1806599, 'ndcg_10': 0.20824847, 'lndcg_5': 0.26013035, 'lndcg_10': 0.28250617, 'lndcg1_5': 0.26196316, 'lndcg1_10': 0.2843247, 'ndcg1_5': 0.18248284, 'ndcg1_10': 0.21006158, 'georisk_10': 0.2761057}]
2023-08-09 16:49:26,928 - allrank.utils.ltr_logging - INFO - Ending execution. Test Metrics Evolution:
[{'ndcg_5': 0.17714049886199634, 'ndcg_10': 0.20812090145245263, 'lndcg_5': 0.25620555306521425, 'lndcg_10': 0.2825790913928214, 'lndcg1_5': 0.2570881655983122, 'lndcg1_10': 0.2834617039259194, 'ndcg1_5': 0.1780231113950943, 'ndcg1_10': 0.2090035139855506}]
2023-08-09 16:49:26,995 - allrank.utils.ltr_logging - INFO - created paths container PathsContainer(local_base_output_path='results-new/', base_output_path='results-new/', output_dir='results-new/results\\novo-testeyahoo', tensorboard_output_path='results-new/tb_evals\\single\\novo-testeyahoo', config_path='localtemp_config.json')
2023-08-09 16:49:26,995 - allrank.utils.ltr_logging - INFO - Config:
 {'click_model': None,
 'data': DataConfig(path='D:\\Colecoes\\BD\\yahoo-c14\\l2r\\usado-risk-loss', num_workers=0, batch_size=20, slate_length=100, validation_ds_role='vali'),
 'detect_anomaly': True,
 'expected_metrics': {'val': {'georisk_10': 0.0,
                              'lndcg_10': 0.0,
                              'lndcg_5': 0.0,
                              'ndcg_10': 0.0,
                              'ndcg_5': 0.0}},
 'loss': NameArgsConfig(name='geoRiskSpearmanLoss', args={}),
 'lr_scheduler': NameArgsConfig(name=None, args={'step_size': 800, 'gamma': 0.5}),
 'metrics': defaultdict(<class 'list'>,
                        {'georisk': [10],
                         'lndcg': [5,
                                   10],
                         'lndcg1': [5,
                                    10],
                         'ndcg': [5,
                                  10],
                         'ndcg1': [5,
                                   10]}),
 'model': ModelConfig(fc_model={}, transformer=TransformerConfig(N=2, d_ff=32, h=2, positional_encoding=None, dropout=0.3), post_model={'output_activation': 'Sigmoid', 'd_output': 1}),
 'optimizer': NameArgsConfig(name='Adam', args={'lr': 0.0001}),
 'training': TrainingConfig(epochs=1, gradient_clipping_norm=None, early_stopping_patience=100),
 'val_metric': 'ndcg_10'}
2023-08-09 16:49:26,996 - allrank.utils.ltr_logging - INFO - will execute copy "localtemp_config.json" "results-new/results\novo-testeyahoo\used_config.json"
2023-08-09 16:49:27,020 - allrank.utils.ltr_logging - INFO - exit_code = 0
2023-08-09 16:49:27,021 - allrank.utils.ltr_logging - INFO - will load train data from D:\Colecoes\BD\yahoo-c14\l2r\usado-risk-loss\Norm.train.txt
2023-08-09 16:49:29,726 - allrank.utils.ltr_logging - INFO - loaded dataset from <_io.BufferedReader name='D:\\Colecoes\\BD\\yahoo-c14\\l2r\\usado-risk-loss\\Norm.train.txt'> and got x shape (19515, 699), y shape (19515,) and query_ids shape (19515,)
2023-08-09 16:49:29,759 - allrank.utils.ltr_logging - INFO - loaded dataset with 1337 queries
2023-08-09 16:49:29,760 - allrank.utils.ltr_logging - INFO - longest query had 117 documents
2023-08-09 16:49:29,764 - allrank.utils.ltr_logging - INFO - train DS shape: [1337, 117, 699]
2023-08-09 16:49:29,764 - allrank.utils.ltr_logging - INFO - will load vali data from D:\Colecoes\BD\yahoo-c14\l2r\usado-risk-loss\Norm.vali.txt
2023-08-09 16:49:32,818 - allrank.utils.ltr_logging - INFO - loaded dataset from <_io.BufferedReader name='D:\\Colecoes\\BD\\yahoo-c14\\l2r\\usado-risk-loss\\Norm.vali.txt'> and got x shape (24501, 699), y shape (24501,) and query_ids shape (24501,)
2023-08-09 16:49:32,856 - allrank.utils.ltr_logging - INFO - loaded dataset with 622 queries
2023-08-09 16:49:32,856 - allrank.utils.ltr_logging - INFO - longest query had 103 documents
2023-08-09 16:49:32,861 - allrank.utils.ltr_logging - INFO - vali DS shape: [622, 103, 699]
2023-08-09 16:49:32,861 - allrank.utils.ltr_logging - INFO - Will pad to the longest slate: 103
2023-08-09 16:49:32,862 - allrank.utils.ltr_logging - INFO - will load test data from D:\Colecoes\BD\yahoo-c14\l2r\usado-risk-loss\Norm.test.txt
2023-08-09 16:49:54,301 - allrank.utils.ltr_logging - INFO - loaded dataset from <_io.BufferedReader name='D:\\Colecoes\\BD\\yahoo-c14\\l2r\\usado-risk-loss\\Norm.test.txt'> and got x shape (165660, 699), y shape (165660,) and query_ids shape (165660,)
2023-08-09 16:49:54,622 - allrank.utils.ltr_logging - INFO - loaded dataset with 6983 queries
2023-08-09 16:49:54,622 - allrank.utils.ltr_logging - INFO - longest query had 129 documents
2023-08-09 16:49:54,655 - allrank.utils.ltr_logging - INFO - test DS shape: [6983, 129, 699]
2023-08-09 16:49:54,656 - allrank.utils.ltr_logging - INFO - Will pad to the longest slate: 129
2023-08-09 16:49:54,657 - allrank.utils.ltr_logging - INFO - total batch size is 20
2023-08-09 16:49:54,657 - allrank.utils.ltr_logging - INFO - Model training will execute on cpu
